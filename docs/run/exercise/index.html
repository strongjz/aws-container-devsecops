<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=62542&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.91.2" />
    <meta name="description" content="AWS Container DevSecOps Workshop">
<meta name="author" content="James Strong">

    <link rel="shortcut icon" href="/images/container-green.png" type="image/x-icon" />

    <title>Running Containers Exercise :: AWS Container DevSecOps</title>

    
    <link href="/css/nucleus.css?1641991373" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1641991373" rel="stylesheet">
    <link href="/css/hybrid.css?1641991373" rel="stylesheet">
    <link href="/css/featherlight.min.css?1641991373" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1641991373" rel="stylesheet">
    <link href="/css/auto-complete.css?1641991373" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1641991373" rel="stylesheet">
    <link href="/css/theme.css?1641991373" rel="stylesheet">
    <link href="/css/tabs.css?1641991373" rel="stylesheet">
    <link href="/css/hugo-theme.css?1641991373" rel="stylesheet">
    
    <link href="/css/theme-green.css?1641991373" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1641991373"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    

  </head>
  <body class="" data-url="/run/exercise/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href='"/") }}'>
  <img src="/images/container-green.png"></a>
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1641991373"></script>
<script type="text/javascript" src="/js/auto-complete.js?1641991373"></script>
<script type="text/javascript">
    
        var baseurl = "\/\/localhost:62542\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1641991373"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='/'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/intro/" title="Introduction" class="dd-item
        
        
        
        ">
      <a href="/intro/">
          Introduction
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/intro/presenter/" title="Presenter" class="dd-item ">
        <a href="/intro/presenter/">
        Presenter
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/intro/sponsor/" title="Chainguard.dev" class="dd-item ">
        <a href="/intro/sponsor/">
        Chainguard.dev
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/intro/intro/" title="CI/CD and Security" class="dd-item ">
        <a href="/intro/intro/">
        CI/CD and Security
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/setup/" title="Workshop Setup" class="dd-item
        
        
        
        ">
      <a href="/setup/">
          Workshop Setup
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/setup/cloud9/" title="AWS Cloud9" class="dd-item ">
        <a href="/setup/cloud9/">
        AWS Cloud9
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/setup/iam/" title="Cloud 9 Settings Configuration" class="dd-item ">
        <a href="/setup/iam/">
        Cloud 9 Settings Configuration
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/setup/tools/" title="Workshop tools" class="dd-item ">
        <a href="/setup/tools/">
        Workshop tools
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/development/" title="Development Environment" class="dd-item
        
        
        
        ">
      <a href="/development/">
          Development Environment
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/development/signing/" title="Git Commit Signing" class="dd-item ">
        <a href="/development/signing/">
        Git Commit Signing
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/development/linting/" title="Linting" class="dd-item ">
        <a href="/development/linting/">
        Linting
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/development/owasp/" title="Open Web Application Security Project" class="dd-item ">
        <a href="/development/owasp/">
        Open Web Application Security Project
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/development/pre-commit/" title="Pre Commit" class="dd-item ">
        <a href="/development/pre-commit/">
        Pre Commit
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/development/3-musketeers/" title="3 Musketeers" class="dd-item ">
        <a href="/development/3-musketeers/">
        3 Musketeers
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/build/" title="Container Builds" class="dd-item
        
        
        
        ">
      <a href="/build/">
          Container Builds
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/build/container/" title="Secure Containers" class="dd-item ">
        <a href="/build/container/">
        Secure Containers
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/build/exercise/" title="Secure Containers Exercise" class="dd-item ">
        <a href="/build/exercise/">
        Secure Containers Exercise
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/pipeline/" title="Container Pipeline" class="dd-item
        
        
        
        ">
      <a href="/pipeline/">
          Container Pipeline
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/pipeline/intro_exercise/" title="Container Pipeline Exercise Overview" class="dd-item ">
        <a href="/pipeline/intro_exercise/">
        Container Pipeline Exercise Overview
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/pipeline/exercise/" title="Container Pipeline Exercise" class="dd-item ">
        <a href="/pipeline/exercise/">
        Container Pipeline Exercise
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/pipeline/exercise_2/" title="Container Pipeline Exercise Part 2" class="dd-item ">
        <a href="/pipeline/exercise_2/">
        Container Pipeline Exercise Part 2
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/run/" title="Running Containers" class="dd-item
        parent
        
        
        ">
      <a href="/run/">
          Running Containers
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/run/exercise/" title="Running Containers Exercise" class="dd-item active">
        <a href="/run/exercise/">
        Running Containers Exercise
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/conclusion/" title="Conclusion" class="dd-item
        
        
        
        ">
      <a href="/conclusion/">
          Conclusion
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/conclusion/survey/" title="Survey" class="dd-item ">
        <a href="/conclusion/survey/">
        Survey
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/conclusion/clean/" title="Cleanup" class="dd-item ">
        <a href="/conclusion/clean/">
        Cleanup
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://github.com/strongjz/aws-container-devsecops"><i class='fab fa-github'></i> AWS Container DevsecOps Github repo</a>
              </li>
          
              <li>
                  <a class="padding" href="https://acloud.guru/overview/advanced-networking-with-kubernetes-for-aws"><i class='fab fa-clouds'></i> Advanced Networking with Kubernetes on AWS</a>
              </li>
          
              <li>
                  <a class="padding" href="https://learning.oreilly.com/library/view/networking-and-kubernetes/9781492081647/"><i class='fas fa-book'></i> Networking and Kubernetes: A Layered Appoarch</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/strongjz/aws-container-devsecopsrun/exercise.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>AWS DevSecOps Container Pipeline</a> > <a href='/run/'>Running Containers</a> > Running Containers Exercise
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#installing-prometheus-to-our-cluster">Installing Prometheus to our cluster</a></li>
    <li><a href="#deploying-fluentbit-for-our-logs">Deploying Fluentbit for our logs</a></li>
    <li><a href="#deploy-falco">Deploy Falco</a>
      <ul>
        <li><a href="#access-urls-under-apiexeccmd-to-run-arbitrary-commands">Access urls under <code>/api/exec/&lt;cmd&gt;</code> to run arbitrary commands.</a></li>
        <li><a href="#try-to-run-bash-via-apiexecbash-falco-sends-alert">Try to run bash via <code>/api/exec/bash</code>, falco sends alert.</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        

        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Running Containers Exercise
            </h1>
          

        


<h2 id="installing-prometheus-to-our-cluster">Installing Prometheus to our cluster</h2>
<p><code>make helm_update</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">helm repo add stable https://charts.helm.sh/stable <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>helm repo update
<span style="color:#e6db74">&#34;stable&#34;</span> has been added to your repositories
Hang tight <span style="color:#66d9ef">while</span> we grab the latest from your chart repositories...
...Successfully got an update from the <span style="color:#e6db74">&#34;stable&#34;</span> chart repository
Update Complete. ⎈Happy Helming!⎈
</code></pre></div><p><code>make prom</code>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Expand me...
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">helm repo add stable https://charts.helm.sh/stable <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>helm repo update
<span style="color:#e6db74">&#34;stable&#34;</span> already exists with the same configuration, skipping
Hang tight <span style="color:#66d9ef">while</span> we grab the latest from your chart repositories...
...Successfully got an update from the <span style="color:#e6db74">&#34;stable&#34;</span> chart repository
Update Complete. ⎈Happy Helming!⎈
kubectl apply -f namespace_prometheus.yml <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>helm install prometheus stable/prometheus <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--namespace prometheus <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>--set alertmanager.persistentVolume.storageClass<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;gp2&#34;</span>,server.persistentVolume.storageClass<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;gp2&#34;</span>
namespace/prometheus created
WARNING: This chart is deprecated
W0911 22:48:05.645050   <span style="color:#ae81ff">16010</span> warnings.go:70<span style="color:#f92672">]</span> rbac.authorization.k8s.io/v1beta1 ClusterRole is deprecated in v1.17+, unavailable in v1.22+; use rbac.authorization.k8s.io/v1 ClusterRole
W0911 22:48:05.656705   <span style="color:#ae81ff">16010</span> warnings.go:70<span style="color:#f92672">]</span> rbac.authorization.k8s.io/v1beta1 ClusterRole is deprecated in v1.17+, unavailable in v1.22+; use rbac.authorization.k8s.io/v1 ClusterRole
W0911 22:48:05.667391   <span style="color:#ae81ff">16010</span> warnings.go:70<span style="color:#f92672">]</span> rbac.authorization.k8s.io/v1beta1 ClusterRole is deprecated in v1.17+, unavailable in v1.22+; use rbac.authorization.k8s.io/v1 ClusterRole
W0911 22:48:05.679784   <span style="color:#ae81ff">16010</span> warnings.go:70<span style="color:#f92672">]</span> rbac.authorization.k8s.io/v1beta1 ClusterRole is deprecated in v1.17+, unavailable in v1.22+; use rbac.authorization.k8s.io/v1 ClusterRole
W0911 22:48:05.691168   <span style="color:#ae81ff">16010</span> warnings.go:70<span style="color:#f92672">]</span> rbac.authorization.k8s.io/v1beta1 ClusterRoleBinding is deprecated in v1.17+, unavailable in v1.22+; use rbac.authorization.k8s.io/v1 ClusterRoleBinding
W0911 22:48:05.703088   <span style="color:#ae81ff">16010</span> warnings.go:70<span style="color:#f92672">]</span> rbac.authorization.k8s.io/v1beta1 ClusterRoleBinding is deprecated in v1.17+, unavailable in v1.22+; use rbac.authorization.k8s.io/v1 ClusterRoleBinding
W0911 22:48:05.716013   <span style="color:#ae81ff">16010</span> warnings.go:70<span style="color:#f92672">]</span> rbac.authorization.k8s.io/v1beta1 ClusterRoleBinding is deprecated in v1.17+, unavailable in v1.22+; use rbac.authorization.k8s.io/v1 ClusterRoleBinding
W0911 22:48:05.733060   <span style="color:#ae81ff">16010</span> warnings.go:70<span style="color:#f92672">]</span> rbac.authorization.k8s.io/v1beta1 ClusterRoleBinding is deprecated in v1.17+, unavailable in v1.22+; use rbac.authorization.k8s.io/v1 ClusterRoleBinding
W0911 22:48:05.962690   <span style="color:#ae81ff">16010</span> warnings.go:70<span style="color:#f92672">]</span> rbac.authorization.k8s.io/v1beta1 ClusterRole is deprecated in v1.17+, unavailable in v1.22+; use rbac.authorization.k8s.io/v1 ClusterRole
W0911 22:48:05.965226   <span style="color:#ae81ff">16010</span> warnings.go:70<span style="color:#f92672">]</span> rbac.authorization.k8s.io/v1beta1 ClusterRole is deprecated in v1.17+, unavailable in v1.22+; use rbac.authorization.k8s.io/v1 ClusterRole
W0911 22:48:05.968345   <span style="color:#ae81ff">16010</span> warnings.go:70<span style="color:#f92672">]</span> rbac.authorization.k8s.io/v1beta1 ClusterRole is deprecated in v1.17+, unavailable in v1.22+; use rbac.authorization.k8s.io/v1 ClusterRole
W0911 22:48:05.968824   <span style="color:#ae81ff">16010</span> warnings.go:70<span style="color:#f92672">]</span> rbac.authorization.k8s.io/v1beta1 ClusterRole is deprecated in v1.17+, unavailable in v1.22+; use rbac.authorization.k8s.io/v1 ClusterRole
W0911 22:48:05.978633   <span style="color:#ae81ff">16010</span> warnings.go:70<span style="color:#f92672">]</span> rbac.authorization.k8s.io/v1beta1 ClusterRoleBinding is deprecated in v1.17+, unavailable in v1.22+; use rbac.authorization.k8s.io/v1 ClusterRoleBinding
W0911 22:48:05.979460   <span style="color:#ae81ff">16010</span> warnings.go:70<span style="color:#f92672">]</span> rbac.authorization.k8s.io/v1beta1 ClusterRoleBinding is deprecated in v1.17+, unavailable in v1.22+; use rbac.authorization.k8s.io/v1 ClusterRoleBinding
W0911 22:48:05.979460   <span style="color:#ae81ff">16010</span> warnings.go:70<span style="color:#f92672">]</span> rbac.authorization.k8s.io/v1beta1 ClusterRoleBinding is deprecated in v1.17+, unavailable in v1.22+; use rbac.authorization.k8s.io/v1 ClusterRoleBinding
W0911 22:48:05.980533   <span style="color:#ae81ff">16010</span> warnings.go:70<span style="color:#f92672">]</span> rbac.authorization.k8s.io/v1beta1 ClusterRoleBinding is deprecated in v1.17+, unavailable in v1.22+; use rbac.authorization.k8s.io/v1 ClusterRoleBinding
NAME: prometheus
LAST DEPLOYED: Sat Sep <span style="color:#ae81ff">11</span> 22:48:05 <span style="color:#ae81ff">2021</span>
NAMESPACE: prometheus
STATUS: deployed
REVISION: <span style="color:#ae81ff">1</span>
TEST SUITE: None
NOTES:
DEPRECATED and moved to &lt;https://github.com/prometheus-community/helm-charts&gt;The Prometheus server can be accessed via port <span style="color:#ae81ff">80</span> on the following DNS name from within your cluster:
prometheus-server.prometheus.svc.cluster.local


Get the Prometheus server URL by running these commands in the same shell:
export POD_NAME<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>kubectl get pods --namespace prometheus -l <span style="color:#e6db74">&#34;app=prometheus,component=server&#34;</span> -o jsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{.items[0].metadata.name}&#34;</span><span style="color:#66d9ef">)</span>
kubectl --namespace prometheus port-forward $POD_NAME <span style="color:#ae81ff">9090</span>


The Prometheus alertmanager can be accessed via port <span style="color:#ae81ff">80</span> on the following DNS name from within your cluster:
prometheus-alertmanager.prometheus.svc.cluster.local


Get the Alertmanager URL by running these commands in the same shell:
export POD_NAME<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>kubectl get pods --namespace prometheus -l <span style="color:#e6db74">&#34;app=prometheus,component=alertmanager&#34;</span> -o jsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{.items[0].metadata.name}&#34;</span><span style="color:#66d9ef">)</span>
kubectl --namespace prometheus port-forward $POD_NAME <span style="color:#ae81ff">9093</span>
<span style="color:#75715e">#################################################################################</span>
<span style="color:#75715e">######   WARNING: Pod Security Policy has been moved to a global property.  #####</span>
<span style="color:#75715e">######            use .Values.podSecurityPolicy.enabled with pod-based      #####</span>
<span style="color:#75715e">######            annotations                                               #####</span>
<span style="color:#75715e">######            (e.g. .Values.nodeExporter.podSecurityPolicy.annotations) #####</span>
<span style="color:#75715e">#################################################################################</span>


The Prometheus PushGateway can be accessed via port <span style="color:#ae81ff">9091</span> on the following DNS name from within your cluster:
prometheus-pushgateway.prometheus.svc.cluster.local


Get the PushGateway URL by running these commands in the same shell:
export POD_NAME<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>kubectl get pods --namespace prometheus -l <span style="color:#e6db74">&#34;app=prometheus,component=pushgateway&#34;</span> -o jsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{.items[0].metadata.name}&#34;</span><span style="color:#66d9ef">)</span>
kubectl --namespace prometheus port-forward $POD_NAME <span style="color:#ae81ff">9091</span>

For more information on running Prometheus, visit:
https://prometheus.io/
</code></pre></div>
    </div>
</div>
</p>
<h2 id="deploying-fluentbit-for-our-logs">Deploying Fluentbit for our logs</h2>
<p>&ldquo;FireLens gives you a simplified interface to filter logs at source, add useful metadata and send logs to almost any destination. You can now stream logs directly to Amazon CloudWatch, Amazon Kinesis Data Firehose destinations such as Amazon Elasticsearch, Amazon S3, Amazon Kinesis Data Streams and partner tools. Using Amazon ECS task definition parameters, you can select destinations and optionally define filters for additional control and FireLens will ingest logs to target destinations.&rdquo;</p>
<p>Update the EKS node group with permissions to push to the log group</p>
<p><code>make deploy-fluent-iam</code></p>
<p>Then Deploy fluent bit <code>make deploy-fluent-bit</code></p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Expand me...
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ 
aws iam create-policy --policy-name EKS-CloudWatchLogs-<span style="color:#e6db74">&#34;devsecops&#34;</span> --policy-document file://./fluent-bit/aws/iam_role_policy.json
<span style="color:#f92672">{</span>
<span style="color:#e6db74">&#34;Policy&#34;</span>: <span style="color:#f92672">{</span>
<span style="color:#e6db74">&#34;PolicyName&#34;</span>: <span style="color:#e6db74">&#34;EKS-CloudWatchLogs-devsecops&#34;</span>,
<span style="color:#e6db74">&#34;PermissionsBoundaryUsageCount&#34;</span>: 0,
<span style="color:#e6db74">&#34;CreateDate&#34;</span>: <span style="color:#e6db74">&#34;2021-09-11T22:48:53Z&#34;</span>,
<span style="color:#e6db74">&#34;AttachmentCount&#34;</span>: 0,
<span style="color:#e6db74">&#34;IsAttachable&#34;</span>: true,
<span style="color:#e6db74">&#34;PolicyId&#34;</span>: <span style="color:#e6db74">&#34;ANPAUKKITVMH4UNGDATVQ&#34;</span>,
<span style="color:#e6db74">&#34;DefaultVersionId&#34;</span>: <span style="color:#e6db74">&#34;v1&#34;</span>,
<span style="color:#e6db74">&#34;Path&#34;</span>: <span style="color:#e6db74">&#34;/&#34;</span>,
<span style="color:#e6db74">&#34;Arn&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:iam::297041898255:policy/EKS-CloudWatchLogs-devsecops&#34;</span>,
<span style="color:#e6db74">&#34;UpdateDate&#34;</span>: <span style="color:#e6db74">&#34;2021-09-11T22:48:53Z&#34;</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
aws iam attach-role-policy --role-name ng-1 --policy-arn <span style="color:#e6db74">`</span>aws iam list-policies | jq -r <span style="color:#e6db74">&#39;.[][] | select(.PolicyName == &#34;EKS-CloudWatchLogs-devsecops&#34;) | .Arn&#39;</span><span style="color:#e6db74">`</span>
</code></pre></div>
    </div>
</div>

<p>We now have deployed the Fluentbit plugin, we should see logs in our CloudWatch log Groups for our application.</p>
<p><img src="/images/run/cloudwatch/png" alt=""></p>
<h2 id="deploy-falco">Deploy Falco</h2>
<p><code>make deploy-falco</code></p>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Expand me...
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">helm repo add falcosecurity https://falcosecurity.github.io/charts; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>helm repo update; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>helm install falco --set falco.jsonOutput<span style="color:#f92672">=</span>true --set image.tag<span style="color:#f92672">=</span>0.24.0 falcosecurity/falco
<span style="color:#e6db74">&#34;falcosecurity&#34;</span> has been added to your repositories
Hang tight <span style="color:#66d9ef">while</span> we grab the latest from your chart repositories...
...Successfully got an update from the <span style="color:#e6db74">&#34;falcosecurity&#34;</span> chart repository
...Successfully got an update from the <span style="color:#e6db74">&#34;stable&#34;</span> chart repository
Update Complete. ⎈Happy Helming!⎈
NAME: falco
LAST DEPLOYED: Tue Sep <span style="color:#ae81ff">21</span> 19:02:22 <span style="color:#ae81ff">2021</span>
NAMESPACE: default
STATUS: deployed
REVISION: <span style="color:#ae81ff">1</span>
TEST SUITE: None
NOTES:
Falco agents are spinning up on each node in your cluster. After a few
seconds, they are going to start monitoring your containers looking <span style="color:#66d9ef">for</span>
security issues.


No further action should be required.


Tip: 
You can easily forward Falco events to Slack, Kafka, AWS Lambda and more with falcosidekick. 
Full list of outputs: https://github.com/falcosecurity/charts/falcosidekick.
You can enable its deployment with <span style="color:#e6db74">`</span>--set falcosidekick.enabled<span style="color:#f92672">=</span>true<span style="color:#e6db74">`</span> or in your values.yaml. 
See: https://github.com/falcosecurity/charts/blob/master/falcosidekick/values.yaml <span style="color:#66d9ef">for</span> configuration values.
</code></pre></div>
    </div>
</div>

<p>You can see in Cloud Watch Falco Logs</p>
<p><a href="https://us-west-2.console.aws.amazon.com/cloudwatch/home?region=us-west-2#logsV2:log-groups/log-group/falco/log-events/alerts">https://us-west-2.console.aws.amazon.com/cloudwatch/home?region=us-west-2#logsV2:log-groups/log-group/falco/log-events/alerts</a></p>
<p><img src="/images/run/falco-logs.png" alt=""></p>
<p>Now we can deploy the demo app to raise alerts in Cloud watch</p>
<p><code>kubectl apply -f falco-demo/nodejs-bad-rest-api/falco-demo.yml</code></p>
<p>Get the Loadbalancer EXTERNAL-IP for the falco-demo</p>
<p><code>kubectl get svc falco-demo</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">NAME         TYPE           CLUSTER-IP       EXTERNAL-IP                                                              PORT<span style="color:#f92672">(</span>S<span style="color:#f92672">)</span>        AGE
falco-demo   LoadBalancer   10.100.249.117   adb9d277014bd4bdd9eef8e94f000f1b-1234566.us-west-2.elb.amazonaws.com   80:32527/TCP   4h9m
</code></pre></div><h3 id="access-urls-under-apiexeccmd-to-run-arbitrary-commands">Access urls under <code>/api/exec/&lt;cmd&gt;</code> to run arbitrary commands.</h3>
<p>Run the following commands to execute arbitrary commands like &lsquo;ls&rsquo;, &lsquo;pwd&rsquo;, etc:</p>
<pre tabindex="0"><code>$ curl http://$LOAD_BALANCER_API/api/exec/ls

demo.yml
node_modules
package.json
README.md
server.js
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl http://$LOAD_BALANCER_API:8181/api/exec/pwd
</code></pre></div><h3 id="try-to-run-bash-via-apiexecbash-falco-sends-alert">Try to run bash via <code>/api/exec/bash</code>, falco sends alert.</h3>
<p>If you try to run bash via <code>/api/exec/bash</code>, falco will generate an alert:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl http://$LOAD_BALANCER_API:8181/api/exec/bash
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">falco          | 22:26:53.536628076: Warning Shell spawned in a container other than entrypoint <span style="color:#f92672">(</span>user<span style="color:#f92672">=</span>root container_id<span style="color:#f92672">=</span>6f339b8aeb0a container_name<span style="color:#f92672">=</span>express_server shell<span style="color:#f92672">=</span>bash parent<span style="color:#f92672">=</span>sh cmdline<span style="color:#f92672">=</span>bash <span style="color:#f92672">)</span>
</code></pre></div><p>Navigate to CloudWatch Logs</p>
<p><img src="/images/run/falco-demo-alert.png" alt=""></p>


<footer class="footline">
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="/run/" title="Running Containers"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/conclusion/" title="Conclusion" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1641991373"></script>
    <script src="/js/perfect-scrollbar.min.js?1641991373"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1641991373"></script>
    <script src="/js/jquery.sticky.js?1641991373"></script>
    <script src="/js/featherlight.min.js?1641991373"></script>
    <script src="/js/highlight.pack.js?1641991373"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1641991373"></script>
    <script src="/js/learn.js?1641991373"></script>
    <script src="/js/hugo-learn.js?1641991373"></script>
    
        
            <script src="/mermaid/mermaid.js?1641991373"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>

